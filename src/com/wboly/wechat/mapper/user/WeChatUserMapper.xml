<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wboly.wechat.dao.user.WeChatUserMapper">

	<!-- 修改用户 -->
	<update id="upDefaultAddressByParm" parameterType="java.util.Map">
		UPDATE vbl_market_base_data.dbo.vbl_user_address SET isDefault=0 
		WHERE userId=#{userId} and astate=0
		UPDATE vbl_market_base_data.dbo.vbl_user_address SET isDefault=1
		WHERE addressId=#{addressId} AND astate=0
	</update>

	<!-- 逻辑删除用户地址信息 -->
	<update id="delAddressInfo" parameterType="java.lang.Integer">
		UPDATE vbl_market_base_data.dbo.VBL_USER_ADDRESS set astate=1,isDefault=0
		where addressId=#{addressId}
	</update>

	<!-- 添加用户收货地址 -->
	<select id="addAddressInfo" parameterType="java.util.Map" resultType="java.lang.Integer">
		INSERT into vbl_market_base_data.dbo.VBL_USER_ADDRESS <!-- output 是sqlserver2005的新特性 (可以从数据修改语句中返回输出，可以看作是“返回结果的DML”) -->
		(userId,provinceId,cityId,areaId,streetId,address,realName,phone,mobile,isDefault) output inserted.addressId
		VALUES(#{userId},#{provinceId},#{cityId},#{areaId},#{streetId},#{address},#{realName},#{phone},#{mobile},#{isDefault});
	</select>

	<!-- 添加用户注册信息 -->
	<insert id="insertUserRegInformation" parameterType="java.util.Map">
		insert into vbl_market_base_data.dbo.vbl_user(userId,userName,regTime,userSource,lastTime,lastLoginType,lastLoginMarker)
		values(${userId}, '${userName}', ${regTime},'${userSource}', ${regTime}, ${lastLoninType}, '${lastLoginMarket}')
	</insert>

	<!-- 修改用户注册信息 -->
	<update id="updateUserRegInformation" parameterType="java.util.Map">
		UPDATE vbl_market_base_data.dbo.vbl_user SET lastTime = ${regTime},
		lastLoginMarker='${lastLoginMarket}' WHERE userId = ${userId}
	</update>

	<!-- 根据用户编号查询用户是否存在 -->
	<select id="selectUserInformation" parameterType="java.util.Map" resultType="String">
		SELECT userId FROM vbl_user WITH (NOLOCK) WHERE userId=${userId}
	</select>
	
	<!-- 添加用户登录记录 -->
	<insert id="insertLoginRecord" parameterType="java.util.Map">
		INSERT  INTO vbl_user_login_record ( userId, loginidentification, agentInformation, loginType, areaId, loginTime )
   	 	VALUES  ( ${userId}, '${lastLoginMarket}', '${agentInfo}', ${loginType}, ${areaId}, ${regTime} );
	</insert>
</mapper>
